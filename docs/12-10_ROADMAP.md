12/10_20:59更新
# ftime ROADMAP (FS Edition v0.1.0 – v1.0.0)

このドキュメントは、`ftime` の **ファイルシステム専用モード（FS-first）** に関する開発ロードマップをまとめたものです。  
対象範囲は **v0.1.0 のMVP** から **v1.0.0 (Filesystem Universal Edition)** までとし、その後に予定している Git 統合や TUI については、本書では「将来の拡張」としてのみ触れます。

---

## 0. 背景とコンセプト

`ftime` は、任意のディレクトリに対して

- 「最近どのファイルを触ったか？」
- 「今日・今週、ここで何が起きていたか？」

を、人間の記憶構造に近い **時間バケット（Active / Today / This Week / History）** で可視化する CLI ツールです。

従来の `ls -lt` は「変更時刻順に並べる」ことは得意ですが、

- 行数が多すぎて一瞬でログが流れる
- 直近の作業だけ見たいのに、過去のファイルがノイズになる
- タイムスタンプが「YYYY-MM-DD HH:MM」表記で、直感的に“どれくらい前か”が分かりにくい

といった課題があります。

`ftime` はこの問題を、次のようなアプローチで解決します。

- ディレクトリ直下（深さ1）のエントリを対象に
- 更新時刻（mtime）に基づいて、4つの時間バケットに分類
- 相対時間表現（「12 mins ago」「Yesterday」「5 days ago」など）で表示
- TTYとパイプで表示形式を切り替え、ツール連携も意識した設計にする

このロードマップは、上記のコンセプトを **「壊さない前提でどう段階的に実装していくか」** を示すためのものです。

---

## 1. 開発フェーズ概要

Filesystem 専用版 (`FS Edition`) のロードマップは、以下の3フェーズで構成します。

```text
Phase 1 : v0.1.x  ── Dogfooding & 安定化
Phase 2 : v0.2.x  ── FS エンハンス (賢さアップ＋ツール連携)
Phase 3 : v1.0.0  ── Filesystem Universal Edition として正式リリース
````

* **Phase 1** は「仕様どおり動くか」「日常で使えるか」を確認しながら、粗い部分を削るフェーズ。
* **Phase 2** は「FSツールとしての付加価値（賢さ・連携しやすさ）」を高めるフェーズ。
* **Phase 3** は「仕様・CLI・互換性を固め、FSツールとして 1.0 を名乗る」フェーズ。

Git 統合 (`git2` / `.gitignore` / status マーカー) や `--explore` の TUI モードなどは、**v1.0.0 以降の別フェーズ** で扱います。

---

## 2. 開発原則

各フェーズ共通の原則として、以下を採用します。

1. **速さ > 機能量**
   `ls` の代替ではなく「ls の前後で補助するツール」であるため、起動体験が重くなるのは許容しません。

   * デフォルトは深さ1の `read_dir` のみ
   * 再帰や重い処理は、明示的なフラグで opt-in する

2. **推論は控えめに、嘘をつかない**
   出自推論（Fresh/Edited/Imported 等）は「当たればうれしいおまけ」であり、
   ファクト（mtime）の上にヒューリスティックを乗せる形にとどめます。
   判定に自信が持てない場合は、積極的に `Unknown` に落とす方針です。

3. **TTY と Pipe の二面性を強く意識する**
   人間が見るときは「バケット＋色＋アイコン」で快適に、
   ツールやスクリプトが扱うときは「シンプルな TSV/JSON」で扱えるようにします。

4. **FS モードの一貫性を守る**
   Git 統合や TUI を追加する際も、FS モードの挙動を変えないようにします。
   「Git が見つかったときだけ情報が“増える”」のが理想であり、FS モードの行動原理は v1.0 時点で固定します。

---

## 3. Phase 1 – v0.1.x : Dogfooding & 安定化

### 3.1 ゴール

* v0.1.0 の仕様どおりに動く実装を完成させる。
* 開発者自身が `~/Downloads` や `/var/log`、プロジェクトルートで毎日使い、
  **明らかにストレスのある挙動・クラッシュを潰す**。
* 仕様の問題なのか、実装の問題なのかを切り分け、
  **「v0.1.x のうちに直すべき点」と「v0.2以降で対応する点」を分類する**。

### 3.2 スコープ（機能）

Phase 1 では、以下を満たす実装を対象とします。

* スキャン対象

  * `std::fs::read_dir` による **深さ1のみのスキャン**
  * ディレクトリ自体は表示対象とするが、中身は見ない
* 隠しファイル

  * デフォルトでは `.` 始まりを除外
  * `--hidden` オプションで含める
* 時間バケット（ローカル時刻基準）

  1. `now - mtime < 1h` : Active Context
  2. `mtime >= 今日の00:00` : Today’s Session
  3. `now - mtime < 7d` : This Week
  4. その他 : History

     * 未来時刻は Active 扱い
* ソート

  * まず `mtime` 降順でソート
  * 同一 `mtime` の場合は `name` 昇順で安定ソート
* バケット表示

  * 各バケットごとに最大 20 件を表示
  * 21件目以降がある場合は、`... and N more` のようなサマリ行を追加
  * 空バケットはデフォルトで非表示（ヘッダも出さない）
* TTY出力

  * バケットごとの見出し（🔥 Active / ☕ Today / 📅 This Week / 💤 History）
  * 相対時間表示（`12 mins ago`, `Yesterday`, `5 days ago` 等）
  * ディレクトリは末尾 `/` ＋ 色（例: 青）で強調
  * シンボリックリンクは `name -> target` 形式で表示
    （解決不可の場合は `<unresolved>`）
* 非TTY出力（パイプ／リダイレクト）

  * `path<TAB>relative_time` 形式の TSV を1行1エントリで出力
  * バケットヘッダ・色は一切出さない
  * ディレクトリや symlink は「パスのみ」を出力対象とし、TTYと同じ相対時間を付与

### 3.3 非機能要件

* パフォーマンス

  * 一般的な開発環境で、数百〜1000件程度のディレクトリでストレスなく動作すること
  * 過度な最適化は Phase 1 では不要だが、明らかに `ls` より体感で遅い場合は原因調査する
* エラー処理

  * 読み取り権限がないファイル／ディレクトリがあっても panic しない
  * 致命的でないエラーは `stderr` に警告を出しつつ、処理継続を優先
* コード品質

  * `cargo fmt`, `cargo clippy -- -D warnings`, `cargo test` を CI で通す
  * 明らかな N+1 I/O や無駄な再スキャンを入れない

### 3.4 Dogfooding で確認したいポイント

* Downloads フォルダで：

  * 「今日落としたファイル」「さっき編集したメモ」が期待どおりのバケットに入るか
  * History が折りたたまれていて、ノイズが減っているか
* `/var/log` で：

  * 直近1時間で動いているログファイルが Active / Today に集約されているか
* プロジェクトルートで：

  * `src/`, `README`, `Cargo.toml` 等が直近の作業順に並んで違和感がないか

### 3.5 Phase 1 の終了条件

* 開発者自身が **1〜2週間以上日常的に使用** した上で、

  * 「v0.1.0 の仕様の範囲でのバグ」が解消されている
  * 「仕様自体の見直しが必要」と感じるポイントが明確にリストアップされている
* v0.1.x 系の ISSUE が「不具合報告」よりも「改善案／拡張」に寄っている

---

## 4. Phase 2 – v0.2.x : FSエンハンス（賢さアップ＋ツール連携）

### 4.1 ゴール

* Filesystem ツールとしての **差別化ポイントを強化** する。
* ただし、新機能追加によって v0.1 の安定性を崩さないことを重視する。
* 「`ftime` を入れておくと、`ls` では得られない視点が手に入る」と感じられる状態を目指す。

### 4.2 重点テーマ

#### 4.2.1 軽量な「出自ラベル」の導入（任意）

* **Optional / Nice-to-have（Phase 2で余力があれば）**
* FSモードでも、簡易的なラベル付けを検討する（`Fresh` は実装済み）：

  * `Fresh` : 直近で作成された（またはダウンロードされた）ファイル
  * `Edited` : 直近で編集されたテキスト・設定ファイル等
* 判定はあくまで `mtime` 中心とし、`btime` は取得できる環境のみ補助的に利用する。
* 嘘をつかないために：

  * 「Imported のような強い意味を持つラベル」は安易に導入しない
  * 判定に自信がなければラベルを付けず、従来どおりの表示とする

#### 4.2.2 フィルタと引数の扱い

* シェルの glob 展開を活用し、次のような利用を快適にする：

  ```bash
  ftime *.log
  ftime *.rs *.toml
  ```
* オプション形式のフィルタ（`--ext rs,toml`）は実装済み。将来的な拡張（複数条件や正規表現など）が必要なら、CLIとの整合性を検討する。

#### 4.2.3 ツール・AI フレンドリな出力

* **JSON 出力は Phase 2 の必須項目（Must）**。`--json` を追加：

  ```bash
  ftime --json
  ```

  * TimeBucket / path / mtime / relative_time / is_dir / is_symlink / symlink_target / label を **後方互換のため固定フィールド** として出力（symlink_target/label は該当時のみ。必要な追加情報は Optional フィールドで拡張）。
  * 将来の TUI や外部ツールが、`ftime` の出力をそのまま取り込めるようにする。
  * ベンチマーク目安（devビルド, 約2,000件, /dev/null）：TTY/TSV ~0.06s, JSON ~0.25s。線形スケール想定。
* 既存の TSV 出力（非TTY）との整合性は維持する。

#### 4.2.4 symlink の扱い強化（余力があれば）

* TTY 出力時にのみ：

  * 解決できない symlink を `⚠ broken` 等で表示し、視覚的に分かるようにする
* FS ツールとして「壊れたリンクに気づける」価値を加える

### 4.3 設計上の制約

* FS モードの基本挙動（バケット定義／ソート順／隠しファイルルール）は可能な限り変えない。
* CLI の互換性を尊重し、既存オプションの意味は変えない。
* 新しいオプションは少数にとどめ、ヘルプメッセージも含めて学習コストを増やしすぎない。

### 4.4 Phase 2 の終了条件

チェックリスト（完了判定）:
- [x] v0.1.x で集めた「FSツールとして欲しい機能」のうち、優先度の高いものが一定数解決されている。
- [x] JSON 出力（必須）や TSV 出力を用いたスクリプト／ツール連携のサンプルが、README や docs に載っている。
- [x] FS モードだけを見ても、「単なる `ls -lt` の砂糖がけ」以上の価値が明確になっている。
- [x] ベンチマーク目安（devビルド, 約2,000件, /dev/null）：TTY/TSV ~0.06s、JSON ~0.25s を達成し、線形スケールで問題ないことを確認。

### 4.5 Phase 2 完了宣言

完了日: 2026-01-10  
判定: 4.4 のチェックリスト全項目を満たしたため Phase 2 完了とする。

---

## 5. Phase 3 – v1.0.0 : Filesystem Universal Edition

### 5.1 ゴール

* `ftime` を **「Filesystem タイムラインツールとして 1.0 を名乗れる」** 状態にする。
* このバージョン以降は、FS モードの基本仕様・CLI・出力形式に対して強い後方互換性を維持することを前提に開発を進める。

### 5.2 取り組むべき項目

#### 5.2.1 CLI と互換性ポリシーの確立

- [x] v1.0 時点でサポートするオプションを明示し、`docs/CLI.md` に凍結仕様として記載する。
- [x] 重要オプション（例: `--all`, `--hidden`, `--json`, `--no-color`）について意味と互換性リスクを明文化する。
- [x] `NO_COLOR` の空文字扱い（空文字でも無効化）を v1.0 仕様に明記する。
- [x] JSON 出力フィールド（path, bucket, mtime, relative_time, is_dir, is_symlink, symlink_target, label）は **v1.0 で凍結**し、変更はメジャーアップデートでのみ行う方針を共有する。
- [x] 残タスク（未着手/今後対応）を整理・管理するチェックリストを docs に付け、Phase 3 に向けて順次消化する。
- [x] 将来的に仕様変更の可能性があるものは、ドキュメント上で「Experimental」としてマークする（v1.0 時点では Experimental なし）。

#### 5.2.2 プラットフォーム検証

- [x] 対象 OS を明示する（例：Linux (major distros), macOS）。
- [ ] time バケットの境界（サマータイム／ローカルタイムの取り扱い）を確認する。
- [ ] `IsTerminal` の挙動（TTY 判定）を確認する。
- [ ] symlink／パーミッションエラー時の挙動の違いを確認する。

#### 5.2.3 ノイズ除外の整理

- [x] デフォルトで無視するファイルの最小セットを定義（`.DS_Store`, `Thumbs.db`）。
- [ ] その他、明らかにノイズとなる一般的なシステムファイルの追加候補を整理する。
- [x] `~/.ftimeignore` の導入と将来拡張余地（gitignore 互換等）を記述する。

#### 5.2.4 品質基準の明確化

- [x] テスト観点（1h/1d/7d境界、hidden、symlink、TTY/非TTY）を v1.0 テスト計画に明文化する。
- [x] CI で `cargo fmt`, `clippy`, `test` を自動実行する方針を明記し、`-D warnings` を維持する。
- [x] 1000件程度の体感パフォーマンス確認と受忍ライン記載を README / docs に反映する。
- [x] Rust/Cargo の最低対応バージョン（edition 2024）を README / docs に明記する。

#### 5.2.5 配布とドキュメント

* 配布：

  * [ ] `cargo install ftime` で利用可能な状態にする。
  * [ ] GitHub Releases で、Linux / macOS 向けのバイナリを提供する。
  * [x] crates.io 公開に必要なメタデータ（homepage / repository / readme 等）を `Cargo.toml` に揃える。
  * [x] `cargo publish --dry-run` と `cargo package --list` で公開内容を検証する。
* ドキュメントの整備：

  * [x] README を v1.0 仕様に更新（FS Universal Edition としての説明に寄せる）
  * [x] `docs/SPEC-v1.0.md` として FS モードの仕様を確定版として記録
  * [x] `docs/ARCHITECTURE.md` を v1.0 時点の構造に追従
  * [x] `docs/TESTPLAN-v1.0.md` を用意し、主要テスト観点を更新

### 5.3 Phase 3 の終了条件

* FS モードの仕様が `SPEC-v1.0` として確定し、以降のバージョンで互換性を重視する体制が整っている。
* CLI・出力フォーマットについて、変更時には Major バージョンアップが必要であるという認識が開発チーム内で共有されている。
* 外部ユーザーに向けて v1.0.0 のリリースノートを公開できる状態になっている。

---

## 6. このロードマップの使い方

* 各フェーズのタスクは GitHub Issues として分解し、`phase:1`, `phase:2`, `phase:3` 等のラベルで管理します。
* 実装者は、現在作業中のフェーズ以降の仕様を無理に前倒しせず、
  **「今のフェーズでやらないと決めたこと」を尊重する** ことを推奨します。
* フィードバックや新しいアイデアは `phase:future` ラベルをつけた Issue として記録し、
  v1.0.0 リリース後に改めて検討します。

---

## 7. 将来の拡張について（参考）

本ロードマップは FS 専用モードに限定していますが、v1.0.0 以降には次のような拡張を検討します。

* Git モード（`.git` 検出時の status 統合・`.gitignore` 適用）
* `ftime --explore` による TUI モード
* プロジェクト横断のセッションビュー（過去の作業チャンクの一覧）

これらは別のドキュメント（`ROADMAP-git-and-tui.md` 等）で扱います。

---

この `ROADMAP.md` は、ftime の FS Edition 開発における「共通の地図」として利用してください。
実装・設計・レビュー・フィードバックのどの場面でも、「いま自分たちはどのフェーズにいて、何を増やす／増やさないのか」を判断する基準になります。
